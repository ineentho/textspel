<div id="combatlog"></div>

<script>
fetch('http://localhost:3000/api/fight/playerA/playerB').then(resp => {
  return resp.json()
}).then(json => {
  console.log(json)

  const combatlog = document.querySelector('#combatlog')

  combatlog.innerHTML += `Fight mellan <i>${json.between[0]}</i> och <i>${json.between[1]}</i><br>`

  json.fight.forEach(line => {
    if (line.type === 'attack') {
      if (line.modifiers.indexOf('miss') !== -1) {
        combatlog.innerHTML += `<i>${line.attacker.name}</i> scrubbade sig<br>`
      } else {
        let blockTxt = line.modifiers.indexOf('block') !== -1 ? ' (Block) ' : ''
        if (line.modifiers.indexOf('crit') !== -1) {
          combatlog.innerHTML += `<i>${line.attacker.name}</i> attackerar <i>${line.defender.name}</i> för <b>${line.damageInflicted}</b> hp ${blockTxt} (${line.defender.hp} hp)<br>`
        } else {
          combatlog.innerHTML += `<i>${line.attacker.name}</i> attackerar <i>${line.defender.name}</i> för ${line.damageInflicted} hp ${blockTxt} (${line.defender.hp} hp)<br>`
        }
      }
    } else if (line.type === 'coinflip') {
      combatlog.innerHTML += `En coinflip bestämmer att <i>${line.starting.name}</i> börjar<br>`
    } else if( line.type === 'status') {

    } else if( line.type === 'fightDone') {
      combatlog.innerHTML += `<br><i>${line.winner.name}</i> rekade <i>${line.loser.name}</i><br>`
    } else if( line.type === 'dotcreate') {
      combatlog.innerHTML += `<i>${line.attacker.name}</i> hit ${line.defender.name} with a bleed</i><br>`
    } else if( line.type === 'bleedtick') {
      combatlog.innerHTML += `<i>${line.defender.name}</i> bleeds for ${line.damage} hp (${line.defender.hp} hp)<br>`
    } else if( line.type === 'round') {
      combatlog.innerHTML += `<b>Round ${line.round}</b><br>`
    } else {
      combatlog.innerHTML += JSON.stringify(line) + '<br>'
    }
  })
})

</script>
